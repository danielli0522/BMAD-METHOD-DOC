# 复杂流程深度分析任务 (Complex Flow Deep Analysis Task)

## 目的 (Purpose)

对代码库扫描中识别的复杂业务流程进行深度分析，创建详细的时序图、步骤分解和配置依赖分析，为复杂流程分析文档提供准确的技术内容。

## 何时使用 (When to Use)

- 代码库扫描任务完成，复杂流程已识别
- 需要为复杂流程分析文档生成详细内容
- 特定流程出现问题需要深度分析

## 前置条件 (Prerequisites)

- 代码库扫描任务已完成
- 复杂流程清单已生成（按重要性排序）
- 技术架构视图已创建

## 执行流程 (Process)

### 1. 流程优先级确认和选择

**重要性评估和筛选：**

[[LLM: 基于代码库扫描结果，确认需要深度分析的流程：

1. **高重要性流程筛选**
   - 标记为"高"重要性的所有流程
   - 验证业务关键性
   - 确认技术复杂度
   - 评估故障影响范围

2. **中重要性流程筛选**
   - 标记为"中"重要性的流程
   - 选择最具代表性的流程
   - 考虑分析资源和时间限制
   - 优先选择与高重要性流程相关的

3. **分析优先级排序**
   - 按业务影响排序
   - 按技术复杂度排序
   - 按故障频率排序
   - 按维护难度排序

确定最终需要深度分析的流程列表（建议 5-15 个流程）]]

### 2. 单个流程深度分析

对每个选定的复杂流程执行以下分析：

#### 2.1 流程概述分析

**业务目标和触发条件：**

[[LLM: 对目标流程进行全面的业务分析：

1. **业务目标识别**
   - 流程要解决的业务问题
   - 预期的业务结果
   - 成功的衡量标准
   - 业务价值评估

2. **触发条件分析**
   - 流程的启动条件
   - 触发事件类型
   - 前置条件要求
   - 输入参数验证

3. **核心复杂性识别**
   - 技术复杂性来源
   - 业务逻辑复杂性
   - 集成复杂性
   - 并发处理复杂性

4. **关键非功能需求**
   - 性能要求（响应时间、吞吐量）
   - 数据一致性要求
   - 可靠性要求
   - 安全性要求

基于代码分析，准确描述这些特征]]

#### 2.2 端到端时序图创建

**详细调用链分析：**

[[LLM: 创建完整的端到端时序图：

1. **参与者识别**
   - 外部系统或用户
   - 内部服务模块
   - 数据库系统
   - 外部 API 服务
   - 消息队列或缓存

2. **调用序列跟踪**
   - 按时间顺序追踪所有调用
   - 包含同步和异步调用
   - 标记关键的业务逻辑判断点
   - 显示错误处理路径

3. **数据库操作标注**
   - SELECT、INSERT、UPDATE、DELETE 操作
   - 事务边界标识
   - 锁等待和并发控制
   - 数据一致性检查点

4. **关键判断分支**
   - 业务规则判断
   - 权限检查点
   - 数据验证逻辑
   - 异常处理分支

生成 Mermaid 时序图，要求：
- 清晰标注聚合步骤（S1、S2、S3等）
- 包含所有关键的系统交互
- 显示数据库操作类型
- 突出业务逻辑判断点
- 标注异步处理部分]]

#### 2.3 关键配置项识别

**配置依赖分析：**

[[LLM: 全面识别影响流程行为的配置项：

1. **配置文件扫描**
   - 应用配置文件 (application.yml, config.json 等)
   - 环境特定配置
   - 框架配置文件
   - 第三方服务配置

2. **环境变量识别**
   - 运行时环境变量
   - 部署环境配置
   - 敏感信息配置
   - 功能开关配置

3. **数据库配置**
   - 连接池配置
   - 事务配置
   - 查询超时设置
   - 索引和约束配置

4. **外部服务配置**
   - API 端点配置
   - 超时和重试配置
   - 认证和授权配置
   - 熔断器配置

按配置来源分类整理，包含配置项名称、用途说明和默认值]]

#### 2.4 详细步骤分解

**聚合步骤分析：**

[[LLM: 将时序图中的聚合步骤进行详细分解：

对时序图中标注的每个聚合步骤（S1、S2、S3等），提供：

1. **步骤作用说明**
   - 步骤的主要功能
   - 在整个流程中的作用
   - 与其他步骤的关系
   - 输入和输出数据

2. **核心业务规则**
   - 关键的业务逻辑判断
   - 业务规则的具体内容
   - 规则的优先级和冲突处理
   - 规则变更的历史和原因

3. **关键逻辑实现**
   - 核心算法逻辑
   - 重要的代码片段（伪代码）
   - 关键的条件判断
   - 循环和递归逻辑

4. **异常处理机制**
   - 可能的异常情况
   - 异常处理策略
   - 错误恢复机制
   - 用户反馈方式

基于实际代码分析，确保信息准确性]]

### 3. 性能和风险分析

#### 3.1 性能特征分析

[[LLM: 分析流程的性能特征：

1. **性能指标评估**
   - 平均响应时间估算
   - 吞吐量能力分析
   - 资源消耗模式
   - 扩展性限制

2. **瓶颈识别**
   - 数据库查询瓶颈
   - 网络 I/O 瓶颈
   - CPU 密集型操作
   - 内存使用瓶颈

3. **优化机会**
   - 缓存使用机会
   - 查询优化建议
   - 并发处理改进
   - 架构优化方向

基于代码复杂度和架构分析进行评估]]

#### 3.2 风险点识别

[[LLM: 识别流程中的潜在风险：

1. **技术风险**
   - 单点故障风险
   - 数据一致性风险
   - 性能降级风险
   - 集成失败风险

2. **业务风险**
   - 业务逻辑错误风险
   - 数据丢失风险
   - 用户体验影响
   - 合规性风险

3. **运维风险**
   - 监控盲点
   - 难以调试的问题
   - 依赖服务风险
   - 配置错误风险

为每个风险提供具体的场景和影响评估]]

### 4. 跨流程关联分析

**流程间依赖和影响：**

[[LLM: 分析多个流程之间的关联：

1. **共享组件识别**
   - 共享的数据库表
   - 共享的服务模块
   - 共享的配置项
   - 共享的外部依赖

2. **数据依赖关系**
   - 流程间的数据传递
   - 数据状态的影响
   - 数据一致性要求
   - 并发访问冲突

3. **级联影响分析**
   - 单个流程故障的影响范围
   - 级联故障的可能路径
   - 影响传播的时间窗口
   - 恢复优先级排序

创建流程依赖图和影响分析矩阵]]

## 输出格式 (Output Format)

### 单个流程分析报告结构

```markdown
## 流程分析: {{流程名称}}

### 流程概述
- **业务目标**: {{目标描述}}
- **触发条件**: {{触发条件列表}}
- **核心复杂性**: {{复杂性分析}}
- **关键非功能点**: {{性能、一致性等要求}}

### 时序图分析
[Mermaid 时序图]

### 关键配置项
- **配置文件**: {{配置来源和关键项目}}
- **环境变量**: {{环境配置列表}}
- **数据库配置**: {{数据库相关配置}}

### 详细步骤分析
- **S1: {{步骤名称}}**: {{详细分析}}
- **S2: {{步骤名称}}**: {{详细分析}}
- **S3: {{步骤名称}}**: {{详细分析}}

### 性能和风险分析
- **性能特征**: {{性能分析}}
- **潜在瓶颈**: {{瓶颈识别}}
- **风险点**: {{风险分析}}
```

### 综合分析报告结构

```markdown
# {{项目名}} 复杂流程深度分析

## 高重要性流程分析
[每个高重要性流程的详细分析]

## 中重要性流程分析
[每个中重要性流程的分析]

## 跨流程关联分析
[流程依赖关系和级联影响]

## 总结和建议
[整体分析结论和改进建议]
```

## 质量检查标准 (Quality Standards)

### 分析深度检查

- [ ] 每个流程都有完整的时序图
- [ ] 时序图包含所有关键系统交互
- [ ] 配置项识别全面且可验证
- [ ] 步骤分析基于实际代码
- [ ] 性能和风险分析有数据支撑

### 准确性验证

- [ ] 时序图与实际代码调用链一致
- [ ] 业务规则描述准确
- [ ] 配置项可以在代码中找到
- [ ] 异常处理逻辑与代码匹配

### 实用性评估

- [ ] 分析结果有助于问题诊断
- [ ] 性能分析指导优化方向
- [ ] 风险识别帮助预防问题
- [ ] 配置信息支持运维操作

## 成功标准 (Success Criteria)

任务成功完成的标志：

- [ ] 所有选定的复杂流程都已深度分析
- [ ] 每个流程都有完整的时序图和步骤分解
- [ ] 配置依赖关系清晰明确
- [ ] 跨流程关联分析完整
- [ ] 性能和风险评估有实用价值
- [ ] 分析结果支持复杂流程分析文档生成

完成此任务后，应具备充分的材料来生成高质量的复杂流程分析文档。
