# 潜在问题诊断任务 (Potential Problem Diagnosis Task)

## 目的 (Purpose)

基于复杂流程分析结果，从站点可靠性工程师(SRE)的角度预测可能出现的用户侧和系统侧问题，并提供具体的解决方案和快速诊断指南。

## 何时使用 (When to Use)

- 复杂流程深度分析已完成
- 需要为问题诊断文档生成内容
- 系统上线前的风险评估
- 生产环境问题预防和准备

## 前置条件 (Prerequisites)

- 复杂流程分析文档已完成
- 系统架构视图已创建
- 技术栈和配置依赖已识别

## 执行流程 (Process)

### 1. 问题预测方法论

**SRE视角的问题分类框架：**

[[LLM: 建立系统化的问题预测框架：

1. **问题分类体系**
   - **用户侧问题**: 用户直接感知的功能异常、性能问题、界面错误
   - **系统侧问题**: 服务不可用、内部错误、资源耗尽、集成失败
   - **性能问题**: 响应缓慢、超时、吞吐量不足、资源瓶颈
   - **数据问题**: 数据不一致、数据丢失、数据损坏、同步问题

2. **问题预测来源**
   - 复杂流程中的风险点
   - 架构设计的薄弱环节
   - 外部依赖的故障模式
   - 配置和部署的常见问题

3. **影响严重程度评估**
   - P0: 系统完全不可用
   - P1: 核心功能严重受影响
   - P2: 部分功能不可用
   - P3: 功能可用但体验较差

4. **故障模式分析**
   - 单点故障模式
   - 级联故障模式
   - 资源竞争问题
   - 时序和并发问题

建立结构化的问题预测方法]]

### 2. 基于流程的问题诊断

对每个已分析的复杂流程执行问题预测：

#### 2.1 用户侧问题预测

**从用户体验角度识别问题：**

[[LLM: 对每个复杂流程，预测用户可能遇到的问题：

1. **功能性问题**
   - 功能无响应或错误
   - 操作失败或异常中断
   - 结果不正确或不完整
   - 状态显示错误

2. **性能问题**
   - 页面加载缓慢
   - 操作响应延迟
   - 超时错误
   - 间歇性卡顿

3. **用户界面问题**
   - 界面显示异常
   - 交互元素失效
   - 错误消息不明确
   - 流程中断无提示

4. **数据一致性问题**
   - 显示数据不一致
   - 操作结果延迟更新
   - 重复操作产生多个结果
   - 数据状态不同步

对每个问题，分析：
- 具体的用户感知现象
- 可能的技术根本原因
- 业务影响程度
- 发生概率评估]]

#### 2.2 系统侧问题预测

**从系统内部角度识别问题：**

[[LLM: 深入分析系统内部可能出现的技术问题：

1. **服务可用性问题**
   - 服务进程崩溃
   - 服务无响应
   - 健康检查失败
   - 依赖服务不可用

2. **数据库问题**
   - 连接池耗尽
   - 死锁和锁等待
   - 查询性能恶化
   - 数据库连接失败

3. **网络和集成问题**
   - 网络超时和重试
   - 外部API调用失败
   - 消息队列堆积
   - 服务间通信异常

4. **资源和性能问题**
   - 内存泄漏和OOM
   - CPU高占用
   - 磁盘空间不足
   - 网络带宽瓶颈

对每个问题，提供：
- 系统监控指标表现
- 日志中的典型错误信息
- 诊断和排查步骤
- 恢复和缓解措施]]

#### 2.3 配置和部署问题

**环境相关问题预测：**

[[LLM: 基于配置依赖分析，预测环境相关问题：

1. **配置错误问题**
   - 配置项错误或缺失
   - 环境变量配置不当
   - 配置文件格式错误
   - 配置版本不匹配

2. **部署相关问题**
   - 部署包版本错误
   - 依赖库版本冲突
   - 权限配置问题
   - 网络策略限制

3. **环境差异问题**
   - 开发与生产环境差异
   - 数据库模式不一致
   - 外部服务配置不同
   - 基础设施差异

对每个问题类别，提供具体的检查方法和解决步骤]]

### 3. 级联故障分析

**系统性风险评估：**

[[LLM: 分析可能的级联故障场景：

1. **数据库故障级联**
   - 主数据库故障影响
   - 从库延迟导致的问题
   - 连接池耗尽的扩散
   - 数据库锁等待传播

2. **服务依赖级联**
   - 上游服务故障影响
   - 下游服务调用堆积
   - 超时和重试风暴
   - 熔断器触发影响

3. **资源竞争级联**
   - CPU高负载扩散
   - 内存不足的传播
   - 网络拥塞影响
   - 存储I/O瓶颈扩散

4. **配置变更级联**
   - 配置错误的影响范围
   - 服务重启的连锁反应
   - 版本升级的兼容性问题
   - 网络策略变更影响

创建级联故障场景图和影响时间线]]

### 4. 快速诊断指南开发

**实用的故障排查流程：**

[[LLM: 为每类问题开发快速诊断指南：

1. **分层诊断策略**
   - 用户界面层检查
   - 应用服务层验证
   - 数据层状态确认
   - 基础设施层监控

2. **关键指标检查**
   - 应用性能指标
   - 系统资源指标
   - 网络连接指标
   - 业务功能指标

3. **日志分析指导**
   - 关键日志文件位置
   - 典型错误模式识别
   - 日志分析工具使用
   - 日志聚合和过滤技巧

4. **命令行诊断工具**
   - 系统状态检查命令
   - 网络诊断命令
   - 进程和资源监控命令
   - 数据库连接测试命令

提供可直接执行的诊断脚本和检查清单]]

### 5. 解决方案设计

**系统化的解决方案框架：**

[[LLM: 为预测的问题设计解决方案：

1. **即时缓解措施**
   - 快速恢复服务的步骤
   - 减轻用户影响的方法
   - 临时绕过问题的方案
   - 紧急回滚程序

2. **根本原因解决**
   - 代码修复方案
   - 配置调整建议
   - 架构改进方向
   - 流程优化建议

3. **预防性措施**
   - 监控和告警设置
   - 自动化检查脚本
   - 健康检查增强
   - 容量规划建议

4. **长期改进计划**
   - 架构重构建议
   - 技术债务解决
   - 运维能力提升
   - 团队培训需求

确保解决方案的可操作性和有效性]]

## 输出格式 (Output Format)

### 问题诊断矩阵格式

```markdown
## {{流程名称}} 问题诊断

### 用户侧问题
| 序号 | 潜在问题现象 (用户视角) | 技术层面的根本原因 | 解决方案 |
|------|---------------------|-------------------|----------|
| 1 | {{用户感知的问题现象}} | {{技术根本原因}} | {{具体解决步骤}} |

### 系统侧问题  
| 序号 | 潜在问题现象 (系统视角) | 技术层面的根本原因 | 解决方案 |
|------|----------------------|-------------------|----------|
| 1 | {{系统表现的问题现象}} | {{技术根本原因}} | {{具体解决步骤}} |

### 快速诊断指南
```bash
# 初步检查
{{检查命令}}

# 深度诊断  
{{诊断命令}}

# 配置验证
{{验证命令}}
```
```

### 综合诊断文档结构

```markdown
# {{项目名}} 问题诊断与快速解决方案

## 各流程问题诊断
[按流程组织的问题诊断表格]

## 跨系统问题诊断
[级联故障和系统性问题]

## 监控与告警建议
[关键指标和告警设置]

## 事件响应预案
[标准响应流程和沟通模板]

## 故障知识库
[常用命令、脚本和恢复程序]
```

## 质量检查标准 (Quality Standards)

### 问题预测准确性

- [ ] 问题预测基于实际的技术风险点
- [ ] 用户侧问题描述符合实际用户体验
- [ ] 系统侧问题与架构特点匹配
- [ ] 根本原因分析准确且具体

### 解决方案实用性

- [ ] 解决方案具体可操作
- [ ] 诊断步骤清晰易懂
- [ ] 命令和脚本可直接使用
- [ ] 涵盖从临时缓解到根本解决的完整方案

### 文档完整性

- [ ] 所有重要流程都有问题预测
- [ ] 级联故障场景分析完整
- [ ] 快速诊断指南实用
- [ ] 知识库内容丰富

## 成功标准 (Success Criteria)

任务成功完成的标志：

- [ ] 所有分析的复杂流程都有对应的问题诊断
- [ ] 问题分类全面，涵盖用户侧和系统侧
- [ ] 解决方案具体可操作
- [ ] 快速诊断指南实用有效
- [ ] 级联故障分析有助于风险管理
- [ ] 文档内容支持问题诊断解决方案文档生成

完成此任务后，应具备完整的问题诊断材料来生成实用的问题诊断与解决方案文档。
